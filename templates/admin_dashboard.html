{% extends 'base.html' %}

{% block title %}Admin Dashboard - AgriConnect{% endblock %}

{% block content %}
<h1 style="text-align:center; margin-top:1rem; color: var(--secondary-green);">🛒 Admin Dashboard</h1>

<h2 style="margin-top:1.5rem; text-align:center; color: var(--primary-green);">User Orders</h2>

<div class="products-container">
  {% for order in orders %}
    <div class="product-card" style="background: linear-gradient(to bottom right, #f0fdf4, #e6f4ea); border: 2px solid var(--primary-green);">

      <p><strong>User:</strong> {{ order.user }}</p>
      <p><strong>Status:</strong> 
        <span style="color: {{ '#f39c12' if order.status == 'Pending' else '#2ecc71' if order.status == 'Completed' else '#e74c3c' }}; font-weight:bold;">
          {{ order.status }}
        </span>
      </p>
      <p><strong>Payment:</strong> {{ order.payment_method | upper }}</p>
      <p><strong>Grand Total:</strong> ₹{{ order.grandtotal }}</p>

      <!-- 🚚 Shipping Status -->
      <p><strong>Shipping Status:</strong> 
        <span style="color: {{ '#f39c12' if order.shipping_status == 'Pending' else '#3498db' if order.shipping_status == 'Shipped' else '#2ecc71' }}; font-weight:bold;">
          {{ order.shipping_status or 'Pending' }}
        </span>
      </p>
      <div class="product-actions" style="margin-top:0.5rem; gap:0.5rem; flex-wrap:wrap;">
        {% if order.shipping_status != 'Delivered' %}
          <a class="btn" style="background: #3498db;" href="{{ url_for('update_shipping', order_id=order._id, status='Shipped') }}">🚚 Mark Shipped</a>
          <a class="btn" style="background: #2ecc71;" href="{{ url_for('update_shipping', order_id=order._id, status='Delivered') }}">📦 Mark Delivered</a>
        {% endif %}
      </div>

      <!-- Items -->
      <div class="order-items" style="margin-top:1rem;">
        <h4 style="color: var(--secondary-green);">Items:</h4>
        <ul style="padding-left:1rem;">
          {% for item in order["items"] %}
            <li>{{ item.name }} × {{ item.quantity }} (₹{{ item.price * item.quantity }})</li>
          {% endfor %}
        </ul>
      </div>

      <!-- Actions -->
      <div class="product-actions" style="justify-content: space-between; margin-top:1rem;">
        <a class="btn" href="{{ url_for('view_order_details', order_id=order._id) }}">🔍 View Details</a>

        {% if order.status != 'Completed' %}
          <a class="btn" style="background: #27ae60;" href="{{ url_for('approve_order', order_id=order._id) }}">✅ Approve</a>
        {% else %}
          <span style="color: #2ecc71; font-weight:bold;">Approved</span>
        {% endif %}
      </div>
    </div>
  {% else %}
    <p style="text-align:center; margin-top:2rem; font-size:1.2rem; color:#555;">No orders placed yet.</p>
  {% endfor %}
</div>
{% endblock %}
