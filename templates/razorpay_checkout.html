{% extends "base.html" %}

{% block title %}Pay with Razorpay{% endblock %}

{% block content %}
<h2 style="text-align:center; margin-top:1rem;">Complete Your Payment</h2>

<div style="text-align:center; margin-top:2rem;">
  <button id="rzp-button" class="btn">Pay ₹{{ grandtotal }}</button>
</div>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
  var options = {
    "key": "{{ key_id }}",  // ✅ dynamic key passed from backend
    "amount": "{{ grandtotal|int * 100 }}",
    "currency": "INR",
    "name": "AgriConnect",
    "description": "Purchase Order",
    "order_id": "{{ razorpay_order['id'] }}",
    "handler": function (response){
      fetch("/payment-success", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(response)
      }).then(res => res.json()).then(data => {
        alert("Payment Successful!");
        window.location.href = "/my_orders";
      });
    },
    "theme": {
      "color": "#4CAF50"
    }
  };
  var rzp1 = new Razorpay(options);
  rzp1.open();
</script>

{% endblock %}
